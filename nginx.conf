server {
    listen 80;
    server_name localhost;
    root /usr/share/nginx/html;

    # Log protocol and SSL status
    access_log  /var/log/nginx/access.log  main;
    set $ssl_status "[FRONTEND] Protocol: HTTP (SSL not enabled)";
    error_log  /var/log/nginx/error.log info;

    location /aq-monitor/ {
        try_files $uri $uri/ /index.html;
        add_header X-SSL-Status "$ssl_status" always;
    }

    location /aq-monitor/api/ {
        proxy_pass http://aq-backend:4001/aq-monitor/api/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        add_header X-SSL-Status "$ssl_status" always;
    }
}

# --- HTTPS server block (uncomment to enable SSL) ---
# server {
#     listen 443 ssl;
#     server_name localhost;
#     root /usr/share/nginx/html;
#
#     ssl_certificate     /etc/nginx/certs/d-kenan-cif.crt;
#     ssl_certificate_key /etc/nginx/certs/d-kenan-cif.key;
#
#     # Log protocol and SSL cert/key paths
#     set $ssl_status "[FRONTEND] Protocol: HTTPS (SSL enabled) | Cert: /etc/nginx/certs/d-kenan-cif.crt | Key: /etc/nginx/certs/d-kenan-cif.key";
#     access_log  /var/log/nginx/access.log  main  if=$request;
#     error_log  /var/log/nginx/error.log info;
#     if ($request_method = GET) {
#         add_header X-SSL-Status "$ssl_status" always;
#         error_log "$ssl_status" info;
#     }
#
#     location /aq-monitor/ {
#         try_files $uri $uri/ /index.html;
#     }
#
#     location /aq-monitor/api/ {
#         proxy_pass http://aq-backend:4001/aq-monitor/api/;
#         proxy_http_version 1.1;
#         proxy_set_header Upgrade $http_upgrade;
#         proxy_set_header Connection 'upgrade';
#         proxy_set_header Host $host;
#         proxy_cache_bypass $http_upgrade;
#     }
# }
